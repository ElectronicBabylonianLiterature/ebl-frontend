language: node_js
jobs:
  include:
  - stage: test
    before_script:
    - curl -L https://codeclimate.com/downloads/test-reporter/test-reporter-latest-linux-amd64
      > ./cc-test-reporter
    - chmod +x ./cc-test-reporter
    - "./cc-test-reporter before-build"
    script:
    - yarn prettier --check ./src
    - yarn lint
    - yarn tsc
    - yarn test --coverage --forceExit --detectOpenHandles
    after_script: "./cc-test-reporter after-build --exit-code $TRAVIS_TEST_RESULT"
  - stage: deploy
    install: skip
    script: skip
    deploy:
      provider: heroku
      edge: true
  - stage: smoke test
    if: branch = master
    install: skip
    script:
    - wget --no-check-certificate --output-document=/dev/null https://www.ebabylon.org
notifications:
  slack:
    secure: IjuJeDm5/BrVwIswSPe8Dh5IFymQTQz3Pe0cbG5TW+HxpEYQDqkf6n0bAyHE1MmmhSg8UemNKl7DfWXz8Dyw4c7Y59O/LKn/OydlzKzws33KvhyeANCMdxoGkK2WA/j9CPWAuVrPWFNhxQp74HFgMQwMJSgvbQ+7OEEokr8fa2qD7RllFHbB6pO98Rnbb2cIuMzJOpt7DgPNCQwCnLQj6jE2uWOia3wPTf/1H2ms9iKxZ5/oUglODBLjm4kOY//aALjIxSwv78zfrxRnRsmTvZOmT6yYMELPiFNR2OEjiVRRt0uGNoolahzf4diWY0nGscyVsZY2j4LxipHqkDNWLVbpoINtZVidyzaCzFM1aC07m7QwC8dBSWzk+v5QlnWzEiCKMnhXOKcE96Yo3rlFK9eoe/Lw+odCgpY3slPyQNmY9bn8Xb293xxrB3Kx2V9GehII79lo0XngFLKyig5oLsWETPkcdJgcVmCXuHZbV7IqFBxZceEai5TR6IO/W/A0KkTRBUhlmqky+QYEHuFjj0fTaQbHndwMfxRsUJIqtYSa15iRC3X0xBlJ3/RCKpstU2UyNbd0K40onOteIywtrXXR/cRBmXCDiimpEwN/tQCHnPXJbHekVdqjme86a9dmXRXkAW9dNzdnP8kiuzkY+PnoDeq6V3xpZKRptQeq58Y=
