language: node_js
jobs:
  include:
  - stage: test
    before_script:
    - curl -L https://codeclimate.com/downloads/test-reporter/test-reporter-latest-linux-amd64
      > ./cc-test-reporter
    - chmod +x ./cc-test-reporter
    - "./cc-test-reporter before-build"
    script:
    - yarn eslint --ext .ts,.tsx src/
    - yarn tsc
    - yarn test --coverage --forceExit --detectOpenHandles
    after_script: "./cc-test-reporter after-build --exit-code $TRAVIS_TEST_RESULT"
  - stage: deploy
    install: skip
    script: skip
    deploy:
      provider: heroku
      edge: true
  - stage: smoke test
    if: branch = master
    install: skip
    script:
    - wget --no-check-certificate --output-document=/dev/null https://www.ebabylon.org
notifications:
  slack:
    secure: qTyNCOKFOQtEJQb/4BUn0qR13ePiKgwwXIkbN8H6i/rPDDtZLf6QGDLT4ZYolmM3URodvcRz0qvSAt40WaBYeZSn3buNFw/ijVJE0Q+FrPStpHIvVKNFfbGPChyGaXWdRXfdsTUVmV2VMXFGiaQ7YB5vS/KGAkUsP1ixZKEHrfU6y3xqmRM9JnTBbFVwVU/HxRxqWzUX8HxyFS+beqKWYI4MvlZGPRsSb012V/z/R3U9eqmahaW6wmdl3eVJ2bSytrPbkN90gVnNw+SIdES3XP9+gVQoU6rfwyCCrqmzcXztoiQM3eDIc3vHHoDWnD6ocKh7V6JsNZb4E02a1rmxnpTcmtFv0JD8NJJ0XJ5M9yaLk4XT2cQV+gzi6dNa2aDgS7uYBXjxIAiFzhl76/CuPceGwqa25UtF+iGBuvUCxN2m0MWZgA+7R1aBYlM+rdHBRgCzDCtBji0/Eaw5KRPQFEuDPBIU9VbVnvbyp9/Tt47rjT3gefV0pVjgJLACNxm794cWbA0/bBzFAvba2HRc3FD2sAVeTwoDvynXQNBypm6hK8Sm/80iB14bl7nHvuVKy7W7csultQqDPbS2HBlOnpa8yDFCA40RKjHr/EgXKNrhXYIoe1PUyhBXUB2oiBiMAlJtRNOgpR0JvEbkVTIvNguv/0tpuV0jKsu9ylMOf90=
